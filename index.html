<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Ronnie Payroll Pro v2.7.0</title>
<style>
:root { --primary: #2962ff; --bg: #f0f4f8; --card-bg: #ffffff; --text: #333; --red-highlight: #d32f2f; --warn: #ffab00; }
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);}
.container{max-width:420px;margin:auto;padding:12px;}
h2{text-align:center;color:var(--primary);margin-bottom:2px;font-size: 24px;}

/* Alert Bar Style */
#reminderBar {
    background: var(--warn); color: #000; padding: 12px; border-radius: 12px;
    text-align: center; font-weight: bold; font-size: 14px; margin-bottom: 12px;
    display: none; border: 2px solid #000; animation: bounce 2s infinite;
}
@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }

.card{background:var(--card-bg);padding:16px;border-radius:16px;margin-bottom:12px;box-shadow:0 8px 20px rgba(0,0,0,.05);}
label{font-size:12px;color:var(--primary);font-weight:bold;display:block;margin-bottom:4px;text-transform:uppercase;}

select, input[type="date"], input[type="number"] {
    width: 100%; height: 48px; padding: 0 12px; font-size: 16px; border-radius: 12px;
    border: 1.5px solid #d1d9e6; margin-bottom: 12px; box-sizing: border-box; 
    background-color: #fcfcfc; color: #333; outline: none; display: block; -webkit-appearance: none;
}

.btn-save {
    width: 100%; height: 50px; background: var(--primary); color: #fff; border: none; 
    border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 10px;
}

table{width:100%;border-collapse:collapse;font-size:13px;}
th{color:#90a4ae;text-align:center;border-bottom:1px solid #eee;padding-bottom:8px;}
td{padding:12px 2px;border-bottom:1px solid #f9f9f9;text-align:center;}

.gate-font { font-size: 16px; font-weight: 900; color: #000; }
.month-font { font-size: 10px; color: #666; }
.holiday-row { background-color: var(--red-highlight) !important; color: white !important; }
.holiday-row .gate-font { color: #fff; }

.salary-box{background:#112240;padding:15px;border-radius:12px;margin-top:10px;text-align:center;border: 1px solid #1e2d4d; color: white;}
.calc-btn { width: 100%; height: 48px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; margin: 10px 0; }
.total-amt{font-size:28px;color:#4caf50;font-weight:bold;margin:10px 0;}
.hide{display:none;}
</style>
</head>
<body onload="initApp()">

<div class="container">
    <h2>Ronnie Ruchal</h2>
    
    <div id="reminderBar">üö® Aaja ko data entry garna baki chha!</div>

    <div class="card">
        <label>Select Date (‡§Æ‡§ø‡§§‡§ø)</label>
        <input type="date" id="inputDate" onchange="autoDetectDay()">
        
        <label>Day Type</label>
        <select id="dayType" onchange="updateUI()">
            <option value="weekday">Weekday (Mon-Fri)</option>
            <option value="saturday">Saturday</option>
            <option value="sunday">Sunday</option>
            <option value="holiday">Public Holiday</option>
        </select>
        
        <div id="workedBox" class="hide">
            <label>Worked Today?</label>
            <select id="worked" onchange="updateUI()">
                <option value="yes">Yes</option>
                <option value="no">No</option>
            </select>
        </div>
        
        <div id="outBox"><label>Out Time</label><select id="outTime"></select></div>
        <button class="btn-save" onclick="saveEntryWithSound()">Save Entry üíæ</button>
    </div>

    <div class="card">
        <label style="margin-bottom:10px;">History (Sorted 1-31)</label>
        <table>
            <thead><tr><th>Date</th><th>Day</th><th>Basic</th><th>OT</th><th>Del</th></tr></thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>

    <div class="salary-box">
        <label>Hourly Rate (‚Ç©)</label>
        <input type="number" id="hourlyRate" value="0" style="width:100%; text-align:center; font-size:20px; border-radius:8px; height:40px;">
        <button class="calc-btn" onclick="calculateSalary()">Calculate Salary</button>
        <div class="total-amt">‚Ç© <span id="finalSalary">0</span></div>
        <button onclick="resetAll()" style="background:#d32f2f; color:white; border:none; padding:8px; border-radius:5px; width:100%;">Reset Month</button>
    </div>
</div>

<script>
const STORE_KEY="ronnie_pro_v2.7.0";
let entries=JSON.parse(localStorage.getItem(STORE_KEY)||"[]");
const weekdayTimes=["5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM","9:30 PM","10:00 PM","10:30 PM","11:00 PM","11:30 PM","12:00 AM"];
const weekendTimes=["5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM"];

function initApp() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('inputDate').value = today;
    autoDetectDay();
    renderHistory();
    checkDailyReminder();
}

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playBeep() {
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.connect(g); g.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(880, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
}

// Fixed Logic: Only hide if EXACT date matches Today
function checkDailyReminder() {
    const todayStr = new Date().toISOString().split('T')[0];
    const hasToday = entries.find(e => e.date === todayStr);
    document.getElementById('reminderBar').style.display = hasToday ? 'none' : 'block';
}

function autoDetectDay() {
    let d = new Date(document.getElementById("inputDate").value);
    let dayNum = d.getDay(); 
    let daySelect = document.getElementById("dayType");
    if(dayNum === 0) daySelect.value = "sunday";
    else if(dayNum === 6) daySelect.value = "saturday";
    else daySelect.value = "weekday";
    updateUI();
}

function updateUI(){
    let day=document.getElementById("dayType").value;
    let worked=document.getElementById("worked").value;
    let out=document.getElementById("outTime");
    out.innerHTML="";
    let currentTimes = (day === "weekday") ? weekdayTimes : weekendTimes;
    currentTimes.forEach(t=>{ let o=document.createElement("option"); o.value=t; o.text=t; out.appendChild(o); });
    if(day==="weekday") { document.getElementById("workedBox").classList.add("hide"); document.getElementById("outBox").classList.remove("hide"); }
    else { document.getElementById("workedBox").classList.remove("hide"); if(worked==="no") document.getElementById("outBox").classList.add("hide"); else document.getElementById("outBox").classList.remove("hide"); }
}

function saveEntryWithSound() { playBeep(); saveEntry(); checkDailyReminder(); }

function saveEntry(){
    let date = document.getElementById("inputDate").value;
    let type = document.getElementById("dayType").value;
    if(entries.find(e=>e.date===date)) return alert("Date Duplicate!");

    let outVal = document.getElementById("outTime").value || "5:30 PM";
    let workedVal = (type==="weekday") ? "yes" : document.getElementById("worked").value;
    let normalOt = 0, nightOt = 0, basicHrs = 0;

    if(type === "weekday") {
        basicHrs = 8;
        let outMins = timeToMins(outVal);
        normalOt = Math.max(0, (Math.min(outMins, 1320) - 1050) / 60);
        nightOt = Math.max(0, (outMins - 1320) / 60);
    } else {
        if(type === "sunday") basicHrs = 8;
        if(workedVal === "yes") {
            let outMins = timeToMins(outVal);
            let extraOt = Math.max(0, (Math.min(outMins, 1320) - 1050) / 60);
            normalOt = 8 + extraOt; 
            nightOt = Math.max(0, (outMins - 1320) / 60);
        }
    }
    entries.push({ date, type, worked:workedVal, normalOt, nightOt, basicHrs });
    entries.sort((a,b)=>new Date(a.date)-new Date(b.date));
    localStorage.setItem(STORE_KEY, JSON.stringify(entries));
    renderHistory();
}

function timeToMins(t) {
    if(!t) return 1050; 
    let [time, mod] = t.split(' ');
    let [h, m] = time.split(':');
    h = parseInt(h);
    if (h === 12) h = (mod === 'AM') ? 0 : 12;
    else if (mod === 'PM') h += 12;
    return (h * 60) + parseInt(m);
}

function renderHistory(){
    let body=document.getElementById("historyBody");
    body.innerHTML="";
    entries.forEach((e,i)=>{
        let d = new Date(e.date);
        let dayNames = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];
        let gateStr = e.date.split('-')[2];
        let monthStr = e.date.split('-')[1];
        let tr=document.createElement("tr");
        if(e.type !== "weekday") tr.className = "holiday-row";
        tr.innerHTML=`<td><span class="gate-font">${gateStr}</span><br><span class="month-font">${monthStr} m</span></td>
                      <td style="font-weight:bold">${e.type==="holiday"?"HOL":dayNames[d.getDay()]}</td>
                      <td>${e.basicHrs}</td>
                      <td style="font-weight:bold">${(e.normalOt+e.nightOt).toFixed(1)}</td>
                      <td><button style="background:none; border:none; color:red;" onclick="delEntry(${i})">üóëÔ∏è</button></td>`;
        body.appendChild(tr);
    });
}

function calculateSalary() {
    let rate = parseFloat(document.getElementById("hourlyRate").value) || 0;
    let totalPay = 0;
    entries.forEach(e => {
        let dayPay = (e.basicHrs * rate); 
        if (e.worked === "yes") dayPay += (e.normalOt * rate * 1.5) + (e.nightOt * rate * 3.0);
        totalPay += dayPay;
    });
    document.getElementById("finalSalary").innerText = Math.round(totalPay).toLocaleString();
}

function delEntry(i){ if(confirm("Delete?")){ entries.splice(i,1); localStorage.setItem(STORE_KEY, JSON.stringify(entries)); renderHistory(); checkDailyReminder(); } }
function resetAll(){ if(confirm("Reset?")){ entries=[]; localStorage.setItem(STORE_KEY,"[]"); renderHistory(); document.getElementById("finalSalary").innerText = "0"; checkDailyReminder(); } }
</script>
</body>
</html>
